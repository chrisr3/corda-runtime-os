plugins {
    id 'corda.common-library'
    id 'corda.common-publishing'
}

description 'Database Core Library'

dependencies {
    api 'org.jetbrains.kotlin:kotlin-osgi-bundle'
    implementation platform("net.corda:corda-api:$cordaApiVersion")

    compileOnly 'org.osgi:osgi.core'
    compileOnly "org.osgi:osgi.annotation"

    // OSGi interface definition for DataSourceFactory, and needed as a bundle
    implementation libs.osgi.service.jdbc
    implementation project(':libs:metrics')

    api libs.hikaricp

    testImplementation libs.assertj.core
    testImplementation libs.mockito.core
    testImplementation libs.mockito.kotlin

    integrationTestRuntimeOnly 'org.osgi:osgi.core'
    integrationTestRuntimeOnly libs.hsqldb
    integrationTestRuntimeOnly libs.postgresql
    integrationTestRuntimeOnly "org.slf4j:slf4j-simple:$slf4jVersion"
}

//  `DataSourceFactory` providers are in the jdbc drivers that we *dynamically* load at runtime
tasks.named('jar', Jar) {
    bnd '''\
-noclassforname: true
Import-Package: org.osgi.service.jdbc;resolution:=optional,\
    *
'''
}
